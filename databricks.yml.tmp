# This is a Databricks asset bundle definition for acme_dab.
# See https://docs.databricks.com/dev-tools/bundles/index.html for documentation.
bundle:
  name: acme_supermarkets_data_pipeline

variables:
  default_pipeline_catalog:
    description: "Default catalog for pipelines"
  default_pipeline_schema:
    description: "Default schema for pipelines"

include:
  # User-managed resource files
-   resources/*.yml
  # LHP-managed resource files - using environment-specific pattern
  # NOTE: You must deploy with matching target name (e.g., databricks bundle deploy --target dev)
  # This assumes one deployment per environment
-   resources/lhp/*.yml


sync:
  include:
  # -   generated/${bundle.target}/*
  -   generated/dev/*

targets:
  dev:
    # This is the CI/CD Dev target for deployment of the bundle to Dev CI/CD workspace
    # for the CI/CD actions to test deployment of the bundle
    mode: development
    default: true
    workspace:
      host: https://XXXXXXXXXXXXXXXXXXXXXXXX.azuredatabricks.net/
      root_path: ~/.bundle/${bundle.name}/${bundle.target}

  dev-free:
    # This is the CI/CD Dev target for deployment of the bundle to Dev CI/CD workspace
    # for the CI/CD actions to test deployment of the bundle
    mode: production
    default: false
    workspace:
      host: https://XXXXXXXXXXXXXXXXXXXXXXXX.cloud.databricks.com
      root_path: /Workspace/ci_cd/.bundle/${bundle.name}/${bundle.target}
    permissions:
    -   service_principal_name: XXXXXXXXXXXXXXXXXXXXXXXX
        level: CAN_MANAGE
    run_as:
      service_principal_name: XXXXXXXXXXXXXXXXXXXXXXXX

  tst:
    # This is the CI/CD TST target for deployment of the bundle to the tst workspace
    # for the CI/CD actions to test deployment of the bundle
    mode: production
    default: false
    workspace:
      host: https://XXXXXXXXXXXXXXXXXXXXXXXX.cloud.databricks.com/
      root_path: /Workspace/ci_cd/.bundle/${bundle.name}/${bundle.target}
    permissions:
    -   service_principal_name: XXXXXXXXXXXXXXXXXXXXXXXX
        level: CAN_MANAGE
    run_as:
      service_principal_name: XXXXXXXXXXXXXXXXXXXXXXXX

  prd:
    # This is the CI/CD Prod target for deployment of the bundle to the prod workspace
    # for the CI/CD actions to test deployment of the bundle
    mode: production
    workspace:
      host: https://XXXXXXXXXXXXXXXXXXXXXXXX.cloud.databricks.com
      root_path: /Workspace/ci_cd/.bundle/${bundle.name}/${bundle.target}
    permissions:
    -   service_principal_name: XXXXXXXXXXXXXXXXXXXXXXXX
        level: CAN_MANAGE
    run_as:
      service_principal_name: XXXXXXXXXXXXXXXXXXXXXXXX
